```markdown
# 北京地铁投诉数据处理脚本

一个基于LM Studio本地大模型的投诉数据智能分析工具，用于从北京地铁投诉工单中自动提取结构化信息。

## 功能特性

- 🤖 **智能信息提取**：使用本地大模型从投诉工单内容中提取关键信息
- 📊 **结构化输出**：自动识别线路、位置、噪音类型、振动类型等关键字段
- 📈 **批量处理**：支持Excel文件批量处理，提供进度显示
- 📋 **统计分析**：自动生成处理统计报告和数据分布分析
- 🔧 **高度可配置**：支持自定义模型和提取字段

## 提取信息类型

- **线路**：地铁线路信息（如1号线、2号线、13号线等）
- **小区/位置**：具体地点、小区名称或站点信息
- **噪音类型**：噪音问题分类（列车噪音、施工噪音、机械噪音等）
- **振动类型**：振动问题分类（列车振动、施工振动等）

## 环境要求

- Python 3.8+
- LM Studio（需要预先启动并加载模型）
- 推荐模型：qwen/qwen3-30b-a3b-mlx

## 安装依赖

```bash
pip install pandas lmstudio tqdm pydantic openpyxl
```

## 使用方法

### 1. 准备工作

确保LM Studio已启动并加载了相应的模型：

```bash
# 启动LM Studio并加载推荐模型
# 模型：qwen/qwen3-30b-a3b-mlx
```

### 2. 准备数据文件

将Excel数据文件放在`data/`目录下，确保包含以下列：
- `工单内容`：投诉的详细内容
- `来电号码`：投诉人联系方式

### 3. 运行脚本

```bash
python metro_complaint_processor.py
```

### 4. 自定义配置

可以通过修改代码中的参数来自定义处理：

```python
# 修改输入输出文件路径
input_file = "your_input_file.xlsx"
output_file = "your_output_file.xlsx"

# 修改使用的模型
processor = MetroComplaintProcessor(model_name="your_model_name")
```

## 输出格式

处理后的Excel文件包含以下列：

| 列名 | 描述 | 示例 |
|------|------|------|
| 工单内容 | 原始投诉内容 | 地铁13号线经过我们小区... |
| 来电号码 | 投诉人电话 | 138****1234 |
| 线路 | 提取的地铁线路 | 13号线 |
| 小区/位置 | 提取的位置信息 | 回龙观小区 |
| 噪音类型 | 噪音问题类型 | 列车噪音 |
| 振动类型 | 振动问题类型 | 列车振动 |

## 处理统计示例

```
=== 处理统计 ===
总记录数: 1500
提取到线路信息的记录数: 1200
提取到小区/位置信息的记录数: 1100
提取到噪音类型的记录数: 800
提取到振动类型的记录数: 600

线路分布:
  13号线: 245 条
  1号线: 198 条
  2号线: 156 条
  ...

噪音类型分布:
  列车噪音: 456 条
  施工噪音: 234 条
  机械噪音: 110 条
  ...
```

## 文件结构

```
project/
├── metro_complaint_processor.py  # 主处理脚本
├── data/                        # 数据目录
│   ├── input_file.xlsx         # 输入文件
│   └── output_file.xlsx        # 输出文件
└── README.md                   # 项目说明
```

## 注意事项

1. **LM Studio连接**：确保LM Studio服务正常运行且模型已加载
2. **处理速度**：为避免对模型造成过大压力，每处理10条记录会暂停1秒
3. **内存使用**：大文件处理时注意内存使用情况
4. **数据质量**：提取准确性取决于工单内容的描述质量

## 性能优化建议

- 使用更大参数的模型可提高提取准确性
- 根据硬件配置调整批处理大小
- 定期清理处理缓存以释放内存

## 常见问题

**Q: 模型连接失败怎么办？**
A: 检查LM Studio是否正常运行，确认模型名称是否正确。

**Q: 提取结果不准确怎么办？**
A: 可以调整prompt提示词或使用更强大的模型。

**Q: 处理速度太慢怎么办？**
A: 可以减少延迟时间或使用更快的模型。

## 作者信息

- **作者**：雷达
- **邮箱**：
  - greatradar@gmail.com
  - dalei@cuhk.edu.hk
  - dalei@scu.edu.cn
